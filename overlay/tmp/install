#!/bin/sh

set -euo pipefail
export BF_E=`basename ${0}`


#======================================================================================================================
# Add postgres user.
#======================================================================================================================

bf-adduser postgres


#======================================================================================================================
# Get PostgreSQL version.
#======================================================================================================================

cd /tmp

VERSION=$(cat POSTGRESQL_BUILD)
bf-echo "PostgreSQL version ${VERSION}."


#======================================================================================================================
# Install PostgreSQL and dependencies.
#======================================================================================================================

bf-echo "Installing PostgreSQL v${VERSION}..."

MAJOR_VERSION="$(echo ${VERSION} | cut -c 1-2)"
apk add --no-cache \
    postgresql${MAJOR_VERSION}=${VERSION}

bf-done


#======================================================================================================================
# Create PostgreSQL directories.
#======================================================================================================================

bf-echo "Creating PostgreSQL directories."

mkdir /data
mkdir /backup
mkdir /run/postgresql


#======================================================================================================================
# Store default crontab as a template.
#======================================================================================================================

cp /etc/crontabs/root /etc/bf/templates/crontab.esh
